<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="favicon.ico">
    <title>Title</title>
</head>
<body>
<script>
    // https://gist.github.com/dima117/960d1250f655a076305e66b0c8f1cda0

    //Массив
    function generateArr(count = 20, show = false, otr = false) {
        let arrData = [];
        for (let i = 0; i < count; i++) {
            const value = Math.floor(Math.random() * 100);
            arrData[i] = otr ? (Math.random() > 0.5 && value !== 0 ? -value : value ) : value;
        }
        if (show)
            console.log('Generate array', arrData);
        return arrData;
    }

    //Дерево
    let treeData = {
        value: 5,
        child: [
            {
                value: 1,
                child: [{value: 2}]
            },
            {
                value: 17,
                child: [
                    {
                        value: 13,
                        child: [{value: 14}]
                    },
                    {
                        value: 15,
                        child: [{value: 16, child: [{value: 17}]}]
                    }
                ]
            }
        ]
    };
    // console.log('Generate tree', treeData);

    // Односвязный список
    function generateList(show) {
        const list = {
            value: 1,
            next: {
                value: 2,
                next: {
                    value: 3,
                    next: {
                        value: 4,
                        next: null
                    }
                }
            }
        };
        if (show)
            console.log('List', list);
        return list;
    }


    // Task 14 Расставить 8 ферзей на шахматной доске, чтобы не били друг друга
    function get8FerziesMap() {
        let mapStart = [], queens = [], fields = [];
        for (let y = 0; y < 8; y++) {
            mapStart[y] = [];
            queens[y] = {x: 0, y: 0};
            for (let x = 0; x < 8; x++) {
                mapStart[y][x] = '';
            }
        }

        fields[0] = mapStart;
        const interval = setInterval(() => {
            let current = fields.length - 1;
            const currentField = fields[current];
            const currentQueen = queens[current];
            const newField = getField(currentQueen, currentField);
            if (newField)
                fields.push(newField);
            else {
                if (fields.length > 1)
                    fields.pop();
                for (let i = current; i < 8; i++) {
                    queens[i] = {x: 0, y: 0};
                }
                current = fields.length - 1;
                if (queens[current].x + 1 > 7) {
                    queens[current].x = 0;
                    queens[current].y++;
                } else
                    queens[current].x++;
            }
            if (fields.length >= 8)
                clearInterval(interval);
            console.clear();
            console.table(fields[fields.length - 1])
        }, 500);

        function getField(queen, field) {
            if (field[queen.y][queen.x] != '')
                return null;
            for (let y = queen.y; y < 8; y++) {
                for (let x = queen.x; x < 8; x++) {
                    const secondField = checkPlaceFerz(field, {x, y});
                    if (secondField)
                        return secondField;
                }
            }
            return null;
        }

        function checkPlaceFerz(testMap, {x, y}) {
            const secondMap = [];
            for (const arr of testMap) {
                secondMap.push([...arr]);
            }
            const vectors = [[0, -1], [-1, 0], [1, 0], [0, 1], [-1, -1], [1, 1], [1, -1], [-1, 1]];
            for (const vector of vectors) {
                let testX = x, testY = y;
                while (testX >= 0 && testY >= 0 && testX < 8 && testY < 8) {
                    if (secondMap[testY][testX] === 1)
                        return null;
                    secondMap[testY][testX] = 0;
                    testY += vector[0];
                    testX += vector[1];
                }
            }
            secondMap[y][x] = 1;
            return secondMap;
        }

        return fields[fields.length - 1];
    }


    // console.table(get8FerziesMap());


    // Task 13 Сортировка слиянием
    function joinSort(arr) {
        let one = arr.slice(0, Math.floor(arr.length / 2));
        if (one.length > 1)
            one = joinSort(one);
        let two = arr.slice(Math.floor(arr.length / 2));
        if (two.length > 1)
            two = joinSort(two);

        const newArr = [];
        for (let i1 = 0, i2 = 0; one[i1] !== undefined || two[i2] !== undefined;) {
            if (one[i1] !== undefined && (two[i2] === undefined || one[i1] <= two[i2]))
                newArr.push(one[i1++]);
            else if (two[i2] !== undefined)
                newArr.push(two[i2++]);
        }
        return newArr;
    }

    // console.log('Сортировка слиянием', joinSort(generateArr(20, true, true)));


    // Task 12 Вывод чисел от 1 до N^2 по спирали
    function spiralString(value) {
        let arr = [];
        for (let i = 0; i < value; i++)
            arr[i] = [];
        let dx = 1, dy = 0;
        let x = 0, y = 0;
        let i = 1;
        while (i <= value * value) {
            arr[y][x] = i.toString();
            if (dx === 1) {
                if (x + 1 >= value || arr[y][x + 1]) {
                    dx = 0;
                    dy = 1;
                }
            }
            else if (dx === -1) {
                if (x - 1 < 0 || arr[y][x - 1]) {
                    dx = 0;
                    dy = -1;
                }
            }
            else if (dy === 1) {
                if (y + 1 >= value || arr[y + 1][x]) {
                    dx = -1;
                    dy = 0;
                }
            }
            else {
                if (y - 1 < 0 || arr[y - 1][x]) {
                    dx = 1;
                    dy = 0;
                }
            }
            x += dx;
            y += dy;
            i++;
        }
        return arr.reduce((acc, el) => `${acc}${el}\n`, '');
    }

    // console.log(spiralString(5));


    // Task 11 Выбрать в массиве фрагмент с наибольшей суммой
    function getMaxPart(arr) {
        return arr.reduce((acc, el, i) => {
            arr.slice(i + 1).reduce((acc2, el2, i2) => {
                acc2.sum += el2;
                acc = acc2.sum > acc.sum ? {...acc2, ...{end: i2 + i + 1}} : acc;
                return acc2;
            }, {sum: el});
            return {...{start: i}, ...acc};
        }, {sum: 0});
    }

    // console.log('Max part\n', getMaxPart(generateArr(20, true, true)));


    // Task 10 Вывести все перестановки чисел о 1 до N
    function replaceNumbers(value) {
        let arr = [];
        const count = getCount(value);
        for (let i = 0; i < count; i++) arr.push([]);

        for (let column = 0; column < value; column++) {
            const delVal = getDelValue(column);
            for (let i = 0, j = 0; j < count; i++) {
                const val = Math.floor(i / delVal) % value + 1;
                if (!existsValue(arr[j], val))
                    arr[j++][column] = val;
            }
        }

        function existsValue(checkArr, checkVal) {
            for (const val of checkArr)
                if (val === checkVal)
                    return true;
            return false;
        }

        function getDelValue(delCount) {
            let delVal = count;
            for (let i = 0; i <= delCount; i++) {
                delVal /= (value - i);
            }
            return delVal;
        }

        function getCount(value) {
            let countValues = 1;
            for (let i = 1; i <= value; i++)
                countValues *= i;
            return countValues;
        }

        return arr;
    }

    //console.log(replaceNumbers(10));


    // Task 9 Развернуть односвязный список
    function reverseList(list) {
        let newList = {};
        let current = list;
        while (current) {
            newList = {next: newList, value: current.value};
            current = current.next;
        }
        return newList
    }

    // console.log(reverseList(generateList(true)));


    //Task 8 Бинарный поиск в отсортированном массиве
    const binarySearch = (d, t, s = 0, e = d.length) => {
        const m = Math.floor((s + e) / 2);
        if (t === d[m]) {
            let f = m;
            while (d[f - 1] === t && f > 0)
                f--;
            return f
        }
        if (e - 1 === s) return -1;
        if (t > d[m]) return binarySearch(d, t, m, e);
        if (t < d[m]) return binarySearch(d, t, s, m);
    };

    //    const arrData = sort(generateArr(20, true));
    //    let findItem = arrData[Math.floor(Math.random() * arrData.length)];
    //    console.log('Find Item', findItem);
    //    console.log('Position item', binarySearch(arrData, findItem));


    // Task 7 Найти все простые числа от 1 до N
    function getEasyNumbers(number) {
        const result = [2];
        for (let value = 3; value < number; value += 2) {
            let toAdd = true;
            for (let j = 0; j < result.length && result[j] <= Math.sqrt(value); j++)
                if (value % result[j] === 0) {
                    toAdd = false;
                    break;
                }
            if (toAdd) result.push(value)
        }
        return result;
    }

    // console.log(getEasyNumbers(1000));


    //Task 6 Баланс скобок в строке ({[
    function balanceString(str) {
        const closeBr = {
            '}': '{',
            ']': '[',
            ')': '('
        };
        const openBr = {
            '{': '}',
            '[': ']',
            '(': ')'
        };
        const stack = [];
        for (let i = 0; i < str.length; i++) {
            if (openBr[str[i]]) stack.push(str[i]);
            else {
                let cb = closeBr[str[i]];
                if (cb) {
                    if (stack[stack.length - 1] === cb) stack.pop();
                    else return false;
                }
            }
        }
        return stack.length === 0
    }

    //    ["({()})", "{(})", "[({])]"].forEach(function (el) {
    //        console.log(el);
    //        console.log(balanceString(el));
    //    });


    //Task 5 Обход дерева в ширину
    function treeInWidth(tree) {
        let result = [];
        let queue = [tree];
        for (let i = 0; i < queue.length; i++) {
            let item = queue[i];
            result.push(item.value);
            if (item.child) queue.push.apply(queue, item.child)
        }
        return result;
    }

    // console.log(treeInWidth(treeData));


    //Task 4 Обход дерева в глубину
    function getArrTree(tree) {
        return [...tree.child ? tree.child.reduce((acc, el) => [...acc, ...getArrTree(el)], []) : [], ...[tree.value]];
    }

    // console.log(getArrTree(treeData));


    //Task 3 Сортировка вставками
    function sortInsert(arr) {
        for (let i = 1; i < arr.length; i++) {
            if (arr[i] < arr[i - 1]) {
                let current = i - 1;
                while (current > 0 && arr[i] < arr[current - 1]) {
                    current--;
                }
                let second = arr[i];
                arr.splice(i, 1);
                arr.splice(current, 0, second)
            }
        }
        return arr
    }

    // console.log('Сортировка вставками', sortInsert(generateArr(20, true)));


    //Task 2 Сортировка выбором
    function sortSelect(arr) {
        let minIndex = 1;
        let currentIndex = 0;
        for (let i = 0; i < arr.length; i++) {
            for (let j = currentIndex + 1; j < arr.length; j++)
                if (arr[j] < arr[minIndex])
                    minIndex = j;
            if (minIndex !== currentIndex)
                [arr[minIndex], arr[currentIndex]] = [arr[currentIndex], arr[minIndex]];
            currentIndex++;
            minIndex = currentIndex;
        }
        return arr
    }

    // console.log('Сортировка выбором', sortSelect(generateArr(20, true)));


    //Task 1 Сортировка пузырьком
    function sort(arr) {
        for (let i = 0; i < arr.length; i++) {
            for (let j = i + 1; j < arr.length; j++) {
                if (arr[i] > arr[j]) {
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
            }
        }
        return arr
    }

    // console.log('Сортировка пузырьком', sort(generateArr(20, true)));


    // Task X Сортировка шейкер
    function sheikerSort(arr) {
        let resultMin = [];
        let resultMax = [];
        while (arr.length > 1) {
            let min = 0, max = 0;
            for (let i = 1; i < arr.length; i++) {
                if (arr[min] > arr[i]) min = i;
                if (arr[max] < arr[i]) max = i;
            }
            resultMin.push(arr[min]);
            resultMax.push(arr[max]);
            arr.splice(Math.max(min, max), 1);
            arr.splice(Math.min(min, max), 1);
        }
        if (arr.length === 1) resultMin.push(arr[0]);
        return [
            ...resultMin,
            ...resultMax.reverse()
        ];
    }

    //console.log(sheikerSort(arrData));


    // Task X Генерация скобочных последовательностей
    function getScopes(count) {
        if (!count)
            return;
        const countScop = count * 2;
        const arr = [];
        const max = 4 ** count - (2 ** count) + 1;
        for (let i = 2 ** count - 1; i < max; i++) {
            arr.push(i);
        }

        function normalize(value) {
            return (new Array(countScop - value.length).fill(0).join('')) + value;
        }

        function balance(str) {
            const stack = [];
            for (let i = 0; i < str.length; i++) {
                if (str[i] === '0') stack.push(str[i]);
                else {
                    if (stack[stack.length - 1] === '0') stack.pop();
                    else return false;
                }
            }
            return stack.length === 0
        }

        return arr
            .map(el => normalize(el.toString(2)))
            .filter((el) => balance(el))
            .map((el) => el.replace(/0/gi, "(").replace(/1/gi, ")"))
    }

    // Task X Анаграммы
    function isAnagram(arr) {
        const [str1, str2] = arr;
        if (str1.length !== str2.length)
            return false;
        let razn = str2.indexOf(str1[0]);
        let isAnagram = true;
        for (let i = 0; i < str1.length; i++) {
            if (str1[i] !== str2[(i + razn) % str2.length]) {
                isAnagram = false;
                break;
            }
        }
        if (isAnagram)
            return true;
        razn = str2.length - 1 - str2.indexOf(str1[0]);
        let isAnagram2 = true;
        for (let i = 0, j = str1.length - 1; i < str1.length; i++, j--) {
            if (str1[i] !== str2[((j - razn) % str2.length + str2.length) % str2.length]) {
                isAnagram2 = false;
                break;
            }
        }
        return isAnagram2;
    }
</script>
</body>
</html>
